<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø­Ø§Ù…ÙŠÙ†</title>
  <style>
    body {
      background-color: #000;
      color: white;
      font-family: Arial;
      text-align: center;
      padding: 30px;
    }
    .expense-box {
      background-color: #1a1a1a;
      padding: 15px;
      margin: 15px auto;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      text-align: right;
      position: relative;
    }
    .total {
      color: #00ffcc;
      font-size: 20px;
      margin-top: 20px;
    }
    .delete-all-btn {
      background: crimson;
      color: white;
      padding: 10px 15px;
      border: none;
      margin-bottom: 20px;
      border-radius: 6px;
      cursor: pointer;
    }
    .delete-btn {
      background: orange;
      color: black;
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2>ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø­Ø§Ù…ÙŠÙ†</h2>

  <!-- Ø²Ø± Ø­Ø°Ù Ø§Ù„ÙƒÙ„ -->
  <button class="delete-all-btn" onclick="deleteAllExpenses()">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</button>

  <div id="expenses-container"></div>
  <div class="total" id="total-expenses"></div>

  <script>
    let total = 0;
    const container = document.getElementById("expenses-container");

    function renderExpenses() {
      container.innerHTML = '';
      total = 0;

      for (let key in localStorage) {
        if (key.startsWith("expenses_")) {
          let userExpenses = JSON.parse(localStorage.getItem(key)) || [];
          let username = key.replace("expenses_", "");

          userExpenses.forEach((exp, index) => {
            total += parseFloat(exp.amount);

            let div = document.createElement("div");
            div.className = "expense-box";
            div.innerHTML = `
              <input type="checkbox" data-user="${username}" data-index="${index}" style="float: left;">
              ğŸ‘¤ <strong>${username}</strong><br>
              ğŸ’° <strong>${exp.amount} Ø¬Ù†ÙŠÙ‡</strong><br>
              ğŸ§¾ ${exp.type}<br>
              ğŸ—“ï¸ ${exp.date}<br>
              ğŸ“ ${exp.note || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª"}
            `;
            container.appendChild(div);
          });
        }
      }

      document.getElementById("total-expenses").innerText =
        `âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ù…ÙŠÙ†: ${total} Ø¬Ù†ÙŠÙ‡`;
    }

    // Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
    function deleteAllExpenses() {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙØŸ")) {
        for (let key in localStorage) {
          if (key.startsWith("expenses_")) {
            localStorage.removeItem(key);
          }
        }
        renderExpenses();
      }
    }

    // Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
    const deleteSelectedBtn = document.createElement("button");
    deleteSelectedBtn.className = "delete-btn";
    deleteSelectedBtn.textContent = "ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯";
    deleteSelectedBtn.onclick = function () {
      const checkboxes = document.querySelectorAll("input[type='checkbox']:checked");
      const expensesMap = {};

      checkboxes.forEach(cb => {
        const username = cb.dataset.user;
        const index = parseInt(cb.dataset.index);
        if (!expensesMap[username]) expensesMap[username] = [];
        expensesMap[username].push(index);
      });

      for (let user in expensesMap) {
        let userKey = "expenses_" + user;
        let current = JSON.parse(localStorage.getItem(userKey) || "[]");
        let updated = current.filter((_, i) => !expensesMap[user].includes(i));
        localStorage.setItem(userKey, JSON.stringify(updated));
      }

      renderExpenses();
    };

    document.body.insertBefore(deleteSelectedBtn, container);
    renderExpenses();
  </script>

</body>
</html>
